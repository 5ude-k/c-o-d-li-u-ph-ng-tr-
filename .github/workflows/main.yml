name: Run Scraper

on:
  schedule:
    - cron: "0 0 * * *"
  workflow_dispatch:
  push:

jobs:
  run-scraper:
    runs-on: ubuntu-latest
    permissions:
      contents: write    # ✅ Quan trọng: cho phép push lên repo

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}  # dùng token mặc định để push

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          pip install requests beautifulsoup4 nbconvert jupyter pandas openpyxl

      - name: Convert and run notebook
        run: |
          jupyter nbconvert --to python API.ipynb
          python API.py > log.txt 2>&1 || true

      - name: Commit scraped data
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          git add nhatot_phongtro_danang_all.xlsx
          git add log.txt
          git commit -m "Auto scrape data $(date +'%Y-%m-%d %H:%M:%S')" || echo "No changes"
          git push



